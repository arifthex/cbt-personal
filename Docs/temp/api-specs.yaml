# ğŸ§  CBT SYSTEM PRD v1.0 (Monorepo Deployment Ready)

**Author:** Bro Cak  
**Stack:** Golang (Backend) Â· Solid.js + shadcn UI (Frontend) Â· PostgreSQL (DB)  
**Release:** v1.0 â€” Production Ready  
**Last Updated:** 2025-10-07

---

## 1ï¸âƒ£ Visi & Tujuan

Sistem CBT (Computer-Based Test) ini dirancang untuk mendukung pelaksanaan ujian digital skala besar dengan:
- efisiensi tinggi (tanpa dependency berat seperti Redis),
- pengawasan ketat (anti-cheat system dengan auto-submit),
- dan performa stabil hingga 5000 peserta serentak.

### ğŸ¯ Target Utama
- âœ… Dapat berjalan pada server **4 core, 4 GB RAM**
- âœ… Performa cepat (load soal tanpa query DB)
- âœ… Caching in-memory soal hingga **H+1**
- âœ… Pengawasan real-time dan audit log lengkap
- âœ… Monorepo untuk efisiensi CI/CD & AI Agent Integration

---

## 2ï¸âƒ£ Struktur Proyek (Monorepo Layout)

```plaintext
/ (root)
â”‚
â”œâ”€â”€ FE/                    # Frontend Solid.js + shadcn UI
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â””â”€â”€ tailwind.config.js
â”‚
â”œâ”€â”€ BE/                    # Backend Golang Service
â”‚   â”œâ”€â”€ cmd/api/main.go
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ exam/
â”‚   â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â”œâ”€â”€ question/
â”‚   â”‚   â”œâ”€â”€ student/
â”‚   â”‚   â”œâ”€â”€ grading/
â”‚   â”‚   â”œâ”€â”€ audit/
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”œâ”€â”€ pkg/
â”‚   â”‚   â”œâ”€â”€ db/              # sqlc generated queries
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ models/
â”‚   â”œâ”€â”€ go.mod
â”‚   â”œâ”€â”€ go.sum
â”‚   â””â”€â”€ .env
â”‚
â”œâ”€â”€ Docs/                  # Dokumentasi
â”‚   â”œâ”€â”€ PRD_CBT_v1.0.md
â”‚   â”œâ”€â”€ ERD.md
â”‚   â”œâ”€â”€ API_Spec.md
â”‚   â”œâ”€â”€ DEPLOY_GUIDE.md
â”‚   â””â”€â”€ CHANGELOG.md
â”‚
â”œâ”€â”€ Deploy/                # Docker & Environment
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ Dockerfile.api
â”‚   â”œâ”€â”€ Dockerfile.fe
â”‚   â”œâ”€â”€ .env.example
â”‚   â””â”€â”€ Makefile
â”‚
â””â”€â”€ README.md

3ï¸âƒ£ Core Entities & Role
Table: users
| Field         | Type                              | Description                 |
| ------------- | --------------------------------- | --------------------------- |
| id            | BIGSERIAL                         | Primary key                 |
| full_name     | VARCHAR                           | Nama lengkap                |
| email         | VARCHAR                           | Unik, digunakan untuk login |
| password_hash | TEXT                              | Disimpan dengan bcrypt      |
| role          | ENUM('admin','teacher','student') | Hak akses                   |
| school_id     | BIGINT                            | FK ke tabel `schools`       |
| created_at    | TIMESTAMPTZ                       | Default `now()`             |

Semua pengguna berada dalam satu tabel users untuk memudahkan integrasi lintas sistem dan login JWT terpusat.

4ï¸âƒ£ Role & Fungsionalitas
Role	Deskripsi	Fungsionalitas Utama
Admin (Pengawas)	Mengawasi ujian dan monitoring cache	Melihat status ujian, memantau RAM cache, hapus cache manual
Guru (Teacher)	Membuat & mem-publish ujian	CRUD soal, publish ujian, melihat hasil
Siswa (Student)	Mengikuti ujian	Login, lihat ujian aktif, kerjakan soal, autosave, anti-cheat
5ï¸âƒ£ Login & Autentikasi
Endpoints

POST /auth/login â†’ menerima {email, password}

POST /auth/refresh â†’ refresh JWT token

Token Structure

Access Token: aktif 60 menit

Refresh Token: aktif 7 hari

Disimpan di Authorization: Bearer <token> header

Library:

github.com/golang-jwt/jwt/v5

Hash password menggunakan bcrypt

6ï¸âƒ£ Manajemen Ujian (Exam Management)

Guru membuat ujian baru (Exam)

Pilih soal dari Question â†’ tersimpan di ExamQuestion

Saat Publish, backend menyimpan soal ke cache in-memory

Soal disimpan di RAM server sampai H+1 dari waktu mulai ujian

Exam Cache Schema
type ExamCache struct {
  ExamID     int64
  Questions  []ExamQuestion
  CreatedAt  time.Time
  ExpireAt   time.Time
}
var CachedExams = map[int64]*ExamCache{}

7ï¸âƒ£ Caching Soal di Memori
Alur:

Guru publish ujian â†’ backend query semua soal â†’ simpan ke CachedExams

Saat siswa mulai ujian â†’ backend load dari cache, bukan DB

Setelah ujian lewat H+1 â†’ cache otomatis dihapus oleh background job

Admin dapat memantau & menghapus cache manual dari dashboard

Cache Admin Endpoints

GET /admin/cache/stats

DELETE /admin/cache/:exam_id

Sample Response
{
  "total_exams_cached": 6,
  "estimated_memory_mb": 45.2,
  "caches": [
    { "exam_id": 101, "expire_at": "2025-10-09T10:00:00Z" }
  ]
}

8ï¸âƒ£ Anti-Cheat System (Auto-Submit)
Trigger Event
Event	Deskripsi	Aksi
fullscreenchange	Keluar dari mode fullscreen	Auto submit
visibilitychange	Tab browser tidak aktif	Auto submit
blur	Window kehilangan fokus	Auto submit


Frontend Logic (Solid.js)
const triggerAutoSubmit = async () => {
  await fetch(`/api/v1/exams/${examId}/auto-submit`, { method: 'POST' });
};
document.addEventListener('visibilitychange', () => {
  if (document.hidden) triggerAutoSubmit();
});
document.addEventListener('fullscreenchange', () => {
  if (!document.fullscreenElement) triggerAutoSubmit();
});
window.addEventListener('blur', triggerAutoSubmit);

Backend Handler (Golang)
func (h *ExamHandler) AutoSubmit(w http.ResponseWriter, r *http.Request) {
  // mark attempt as force_submitted
  // log anti-cheat event in AuditLog
}

9ï¸âƒ£ Audit Log
Table: audit_logs
| Field           | Type        | Description                             |
| --------------- | ----------- | --------------------------------------- |
| id              | BIGSERIAL   | PK                                      |
| user_id         | BIGINT      | FK ke `users`                           |
| action          | VARCHAR     | Event (login, submit, anti_cheat_event) |
| target_resource | VARCHAR     | exam / question / user                  |
| target_id       | BIGINT      | Resource ID                             |
| details         | JSONB       | Additional info                         |
| created_at      | TIMESTAMPTZ | Timestamp                               |


ğŸ”Ÿ Kinerja & Batasan Sistem
| Aspek         | Target           | Implementasi                                |
| ------------- | ---------------- | ------------------------------------------- |
| Server        | 4 core, 4 GB RAM | Optimasi Go runtime + PG connection pooling |
| Concurrency   | 5000 siswa aktif | In-memory cache & non-blocking autosave     |
| DB            | PostgreSQL 14+   | Indexing + sqlc prepared statements         |
| Autosave      | 60 detik         | Async goroutine batch writer                |
| Cache RAM     | < 100 MB typical | Struct + GC-safe slice                      |
| Response time | < 200ms p95      | Cache-first read                            |


1ï¸âƒ£1ï¸âƒ£ Docker Deployment
docker-compose.yml

version: "3.9"
services:
  api:
    build:
      context: ./BE
      dockerfile: ../Deploy/Dockerfile.api
    env_file: ./Deploy/.env
    ports:
      - "8080:8080"
    restart: always

  frontend:
    build:
      context: ./FE
      dockerfile: ../Deploy/Dockerfile.fe
    ports:
      - "5173:80"
    restart: always

  postgres:
    image: postgres:14
    environment:
      POSTGRES_DB: cbt
      POSTGRES_USER: cbt_user
      POSTGRES_PASSWORD: cbt_pass
    volumes:
      - pgdata:/var/lib/postgresql/data
    restart: always

volumes:
  pgdata:


1ï¸âƒ£2ï¸âƒ£ Observability & Monitoring
| Komponen           | Fungsi                                  |
| ------------------ | --------------------------------------- |
| Prometheus Metrics | `/metrics` endpoint di backend          |
| Cache Monitor      | Admin dashboard menunjukkan cache usage |
| Audit Log Viewer   | UI untuk admin menelusuri aktivitas     |
| Log                | JSON structured (zap/zerolog)           |
| Healthcheck        | `/health` endpoint untuk status API     |


1ï¸âƒ£3ï¸âƒ£ Roadmap Pengembangan
| Tahap | Modul                     | Estimasi | Output               |
| ----- | ------------------------- | -------- | -------------------- |
| 1     | Auth + User + Role        | 1 minggu | JWT Login            |
| 2     | Question Bank + Exam Mgmt | 2 minggu | CRUD Soal + Publish  |
| 3     | Exam Execution + Cache    | 3 minggu | Siswa kerjakan ujian |
| 4     | Anti-Cheat Auto-Submit    | 2 minggu | Proteksi aktif       |
| 5     | Admin Cache Monitor       | 1 minggu | Dashboard RAM        |
| 6     | Optimization & Load Test  | 1 minggu | 5000 user stable     |


Total Estimasi: Â±10 minggu dev aktif (1 BE + 1 FE)

1ï¸âƒ£4ï¸âƒ£ Acceptance Criteria

âœ… Login JWT berjalan (semua role)
âœ… Guru publish â†’ soal tersimpan di RAM cache
âœ… Siswa load soal langsung dari cache
âœ… Anti-cheat trigger â†’ auto-submit sukses
âœ… Admin melihat & hapus cache manual
âœ… Audit log merekam semua aktivitas utama
âœ… Sistem stabil untuk 5000 peserta aktif

1ï¸âƒ£5ï¸âƒ£ License & Ownership

- Source code & PRD dimiliki oleh Bro Cak.
- Semua aset monorepo ini akan dikelola di GitHub private repository.
- AI Agent diperbolehkan membaca folder /Docs untuk auto-documentation dan code generation.

End of PRD v1.0
ğŸ“ File path recommendation: /Docs/PRD_CBT_v1.0.md
ğŸ§© Compatible for AI Agent Codebase Integration